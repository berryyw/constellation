## 目标
- 不改动后端代码，改为使用国内可访问的 OpenAI 兼容端点（如 SiliconFlow）。
- 通过云托管环境变量完成切换，保持现有接口与前端调用不变。

## 选择与配置
- 推荐端点：`https://api.siliconflow.cn`（OpenAI 兼容，国内可达）。
- 云托管环境变量：
  - `USE_LLM=true`
  - `LLM_PROVIDER=openai-compatible`
  - `LLM_BASE_URL=https://api.siliconflow.cn`
  - `LLM_MODEL=<兼容模型，如 qwen2.5 或 glm-4>`
  - `LLM_API_KEY=<你的平台密钥>`
  - 可选：`LLM_TIMEOUT=15000`、`LLM_CACHE_TTL=86400`、`RATE_LIMIT_PER_MIN=60`
- CORS：`CORS_ORIGINS` 保持你的小程序请求域名（HTTPS）。

## 实施步骤
1. 在微信云托管控制台 → 服务版本 → 创建/编辑版本 → “环境变量”中设置以上键值；发布新版本。
2. 检查小程序“合法请求域名”已包含你的后端域名（HTTPS）。
3. 不修改仓库代码（已支持 openai-compatible），仅依赖新的环境变量生效。
4. 安全处理：`.env.example` 中的 `LLM_API_KEY` 替换为占位（不存放真实密钥）。

## 验证
- 直接请求：`/api/horoscope/rich?date=YYYY-MM-DD&constellation=巨蟹座` 应返回包含分栏详情的 JSON。
- 一致性：同一 `date+constellation` 命中缓存（24h）；跨日更新。
- 失败回退：模型不可用时接口自动回退到本地生成，前端正常显示。

## 回滚
- 将 `USE_LLM=false` 后发布新版本，立即恢复随机模式。

## 交付与后续
- 我将完成：环境变量检查指引、README 补充说明（若需要）、密钥占位处理。
- 可选：根据实际模型名称微调 prompt 风格（无需改代码，现有模板已适配）。